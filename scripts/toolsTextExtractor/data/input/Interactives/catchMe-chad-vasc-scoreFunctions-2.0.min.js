function toggleDecisionBtn(e,t){for(var n=t.length,r=0;n>r;r++){$("#"+t[r].id).change(DecisionButtonStyles.CENTER_BUTTON_STYLE);var o=document.getElementById(t[r].id);if("undefined"!=typeof o&&null!==o){var a=o.childNodes[0],l=a.childNodes.length;if(l>0){var i=a.style;i.background="#ffffff",i.border="1px solid #e0e0e0",i.color="#acaeaf"}}}var s=document.getElementById(e);if("undefined"!=typeof s&&null!==s){var a=s.childNodes[0],l=a.childNodes.length;if(l>0){var i=a.style;i.background="#3d6ccc",i.border="1px solid #3d6ccc",i.color="#ffffff"}}}function getBoxInfo(e){for(var t="",n=(text.length,0);n<text.length;n++)if(text[n].boxId===e){t=text[n];break}return t}function Score(e,t,n,r){var o=new Object;return o.toolType=e,o.boxStructure=t,o.buttonStructure=n,o.header=r,o}function loadDataFile(e){var t,n=document.getElementById("mainDiv"),r=0;if(0===r)try{t=text[r],metaInfo=new Score(t.toolType,t.boxStructure,t.buttonStructure,t.header),r++,""===e&&(scoreHistory=[])}catch(o){var a=new exception("Score Data file not found",o);a.displayMessage()}n.appendChild(getScore(metaInfo)),""!==e&&loadHistory(e),addFooter()}function isFooterExists(){var e=!1,t=document.getElementsByClassName("footer"),n=document.getElementsByClassName("extra-buttons-div");return"undefined"!=typeof t&&"undefined"!=typeof n&&(e=!0),e}function getScore(e){colspanFactor=getColspanFactor();var t=document.createElement("div");return t.setAttribute("class","question-div"),t.appendChild(getHeader(e.header)),t.appendChild(getScoreTable()),e.toolType!==ToolType.RESULT_SCORE&&e.toolType!==ToolType.RESULT_CATEGORIES_SCORE||t.appendChild(getResultTable(getBoxInfo("997"))),t}function loadHistory(e){try{scoreHistory=JSON.parse(e),console.log("loadHistory : "+JSON.stringify(scoreHistory));for(var t=scoreHistory.length,n=0;t>n;n++){var r=document.getElementById("row"+scoreHistory[n].rowIndex+"_cell"+scoreHistory[n].cellIndex);if(null!==r){var o=r.childNodes[0],a=o.childNodes.length;if(a>0&&""!==scoreHistory[n].cellIndex){var l=o.style;l.background="#3d6ccc",l.border="1px solid #3d6ccc",l.color="#ffffff"}}}metaInfo.toolType!==ToolType.RESULT_CATEGORIES_SCORE?generateResult():restoreCategoriesResult()}catch(i){var s=new exception("Score history string parsing exception",i);s.displayMessage()}}function getResultTable(e){var t=e.boxType,n=document.createElement("div");if(n.setAttribute("class","result-div"),t===ResultBoxTypes.RESULT_BOX)""!==e.extraInformation&&n.appendChild(getExtraInformation(e)),n.appendChild(getInferenceDiv(e));else if(t===ResultBoxTypes.RESULT_SCORE_BOX)n.appendChild(getScoreDiv(e)),""!==e.extraInformation&&n.appendChild(getExtraInformation(e)),n.appendChild(getInferenceDiv(e));else if(t===ResultBoxTypes.SCORE_BOX)n.appendChild(getScoreDiv(e)),""!==e.extraInformation&&n.appendChild(getExtraInformation(e));else if(t===ResultBoxTypes.RESULT_CATEGORIES){for(var r=0;r<e.categories.length;r++)n.appendChild(getCategoriesResultDiv(e,r));""!==e.extraInformation&&n.appendChild(getExtraInformation(e))}else t===ResultBoxTypes.RESULT_SCORE_PERCENTAGE_BOX&&(n.appendChild(getScoreDiv(e)),n.appendChild(getPercentageInfoDiv(e)),n.appendChild(getInferenceDiv(e)));return n}function getExtraInformation(e){var t=document.createElement("div"),n=document.createElement("p");return n.setAttribute("class","extra-info-text"),n.innerHTML=document.createTextNode(e.extraInformation).data,t.appendChild(n),t}function getScoreDiv(){var e=document.createElement("table");e.setAttribute("class","result-div");var t=document.createElement("tr"),n=document.createElement("p");n.setAttribute("class","score-info-text"),n.appendChild(document.createTextNode("Score"));var r=document.createElement("td");r.appendChild(n),r.setAttribute("colspan","1");var o=document.createElement("p");o.setAttribute("id","scoreText");var a=document.createElement("td");return a.setAttribute("class","score-text"),r.setAttribute("colspan","1"),a.appendChild(o),t.appendChild(r),t.appendChild(a),e.appendChild(t),e}function getInferenceDiv(e){var t=document.createElement("div");t.setAttribute("class","result-div");var n=document.createElement("p");n.setAttribute("class","result-info-text"),"undefined"!=typeof e.resultInfoText?n.innerHTML=document.createTextNode(e.resultInfoText).data:n.innerHTML=document.createTextNode("");var r=document.createElement("p");return r.setAttribute("class","result-text"),r.setAttribute("id","resultText"),t.appendChild(n),t.appendChild(r),t}function getPercentageInfoDiv(e){var t=document.createElement("div");t.setAttribute("class","result-div");var n=document.createElement("p");n.setAttribute("class","result-info-text"),"undefined"!=typeof e.resultInfoText?n.innerHTML=document.createTextNode(e.percentageInfoText).data:n.innerHTML=document.createTextNode("");var r=document.createElement("p");return r.setAttribute("class","result-text"),r.setAttribute("id","percentText"),t.appendChild(n),t.appendChild(r),t}function getCategoriesResultDiv(e,t){var n=e.categories,r=document.createElement("div");r.setAttribute("class","result-div");var o=document.createElement("p");o.setAttribute("class","result-info-text"),"undefined"!=typeof n[t]?o.innerHTML=document.createTextNode(n[t]).data:o.innerHTML=document.createTextNode("");var a=document.createElement("p");return a.setAttribute("class","result-text"),a.setAttribute("id","category"+t),r.appendChild(o),r.appendChild(a),r}function getScoreTable(){var e=document.createElement("table");e.setAttribute("class","score-table");for(var t=text.length,n=1;t-3>n;n++){var r=text[n];e.appendChild(getScoreRow(r,n)),scoreHistory.push({rowIndex:n.toString(),cellIndex:"",status:"false"})}return e}function getScoreRow(e,t){var n=document.createElement("tr");if(n.setAttribute("id",t),n.setAttribute("class","score-row"),n.appendChild(getQuestionCell(e.infoText)),metaInfo.buttonStructure===ButtonStructure.BUTTON_SINGLE_LINE_NON_TABULAR_SPANNED)var r=e.options.length;else r=getMaxButtons();for(var o=0;r>o;o++){var a=document.createElement("td");a.setAttribute("class","option-cell"),a.setAttribute("colspan",(colspanFactor/r).toString());var l=document.createElement("p");"undefined"!=typeof e.options[o]?(a.setAttribute("id","row"+t+"_cell"+o),l.innerHTML=document.createTextNode(e.options[o].text).data,metaInfo.buttonStructure===ButtonStructure.BUTTON_SINGLE_LINE_NON_TABULAR_SPANNED&&r<getMaxButtons()?l.setAttribute("class","option-cell-text-spanned"):l.setAttribute("class","option-cell-text")):(l.innerHTML=document.createTextNode("").data,l.setAttribute("class","option-cell-empty")),a.appendChild(l),n.appendChild(a)}return n}function getQuestionCell(e){var t=document.createElement("td");t.setAttribute("class","question-cell");var n=document.createElement("p");return n.setAttribute("class","bold-text"),n.innerHTML=document.createTextNode(e).data,t.appendChild(n),t}function getHeader(e){var t=document.createElement("table");t.setAttribute("class","header-div");var n=document.createElement("tr"),r=document.createElement("td");r.setAttribute("class","question-cell");var o=document.createElement("p");o.setAttribute("class","bold-text"),o.innerHTML=document.createTextNode(e.headerText).data,r.appendChild(o),n.appendChild(r);var a=e.options;if("undefined"!=typeof a)for(var l=0;l<a.length;l++){var i=document.createElement("td");i.setAttribute("class","option-cell");var s=document.createElement("p");s.innerHTML=document.createTextNode(a[l].text).data,metaInfo.buttonStructure===ButtonStructure.BUTTON_SINGLE_LINE_NON_TABULAR_SPANNED?(s.setAttribute("class","header-cell-text-spanned"),i.setAttribute("colspan",(colspanFactor/a.length).toString())):s.setAttribute("class","header-cell-text"),i.appendChild(s),n.appendChild(i)}return t.appendChild(n),t}function getMaxButtons(){for(var e=[],t=text.length,n=1;t-3>n;n++){var r=text[n];e.push(r.options.length)}return Math.max.apply(Math,e)}function amendHistory(e,t){if(0!==t||0>t){var n=getBoxInfo((Number(e)+1).toString()),r=Number(t)-1;scoreHistory[e].cellIndex=r.toString();for(var o=scoreHistory.length,a=0;o>a;a++){var l=scoreHistory[a].cellIndex;if(""!==l&&a===Number(e)){var i=n.options[Number(l)];"undefined"!=typeof i&&"-1"!==i.value?scoreHistory[e].status="true":scoreHistory[e].status="false"}}console.log("amendHistory : "+JSON.stringify(scoreHistory)),metaInfo.toolType!==ToolType.RESULT_CATEGORIES_SCORE?generateResult():generateCategoriesResult(e,t)}}function restoreCategoriesResult(){for(var e=scoreHistory.length,t=0;e>t;t++){var n=scoreHistory[t];if("0"===n.cellIndex){var r=document.getElementById("category"+text[t+1].category),o=r.childNodes;if(0===o.length){var a=document.createElement("ul");a.setAttribute("id","list"+text[t+1].category),r.appendChild(a)}else a=document.getElementById("list"+text[t+1].category);var l=document.createElement("li");l.innerHTML=document.createTextNode(text[t+1].infoText).data,a.appendChild(l)}}}function generateCategoriesResult(e,t){console.log(e+" / "+t),console.log(JSON.stringify(scoreHistory));var n=text[Number(e)+1],r=text[Number(e)+1].category,o=document.getElementById("category"+r),a=o.childNodes;if("Yes"===n.options[Number(t)-1].text){if(0===a.length){var l=document.createElement("ul");l.setAttribute("id","list"+r),o.appendChild(l)}else l=document.getElementById("list"+r);removeListItem(a,n.infoText,r);var i=document.createElement("li");i.innerHTML=document.createTextNode(n.infoText).data,l.appendChild(i)}else removeListItem(a,n.infoText,r)}function removeListItem(e,t,n){if(e.length>0&&e[0].childNodes.length>0)for(var r=e[0].childNodes,o=0;o<r.length;o++){var a=(new DOMParser).parseFromString(t,"text/html");if(r[o].innerHTML===a.body.innerHTML){document.getElementById("list"+n).removeChild(r[o]);break}}}function generateResult(){for(var e=!1,t=scoreHistory.length,n=0;t>n;n++){if(!JSON.parse(scoreHistory[n].status)){e=!1;break}e=!0}var r=getBoxInfo("997").boxType;if(e){var o=getInference(e,r);if(r===ResultBoxTypes.RESULT_SCORE_BOX){var a=document.getElementById("resultText");a.innerHTML=o[0].inferenceText;var l=document.getElementById("scoreText");l.innerHTML=o[0].scoreSum}else if(r===ResultBoxTypes.RESULT_BOX){var a=document.getElementById("resultText");1===o[0].scoreSum&&"1"===scoreHistory[6].cellIndex?a.innerHTML="No antiplatelet or anticoagulant treatment (IIIB)":a.innerHTML=o[0].inferenceText}else if(r===ResultBoxTypes.SCORE_BOX){var l=document.getElementById("scoreText");l.innerHTML=o[0].scoreSum}else if(r===ResultBoxTypes.RESULT_SCORE_PERCENTAGE_BOX){var a=document.getElementById("resultText"),l=document.getElementById("scoreText");l.innerHTML=o[0].scoreSum;var i=document.getElementById("percentText");i.innerHTML=getPercentage(o[0].scoreSum),1===o[0].scoreSum&&"1"===scoreHistory[6].cellIndex?a.innerHTML="No antiplatelet or anticoagulant treatment (IIIB)":a.innerHTML=o[0].inferenceText}}else r===ResultBoxTypes.RESULT_SCORE_BOX?(document.getElementById("resultText").innerHTML="",document.getElementById("scoreText").innerHTML=""):r===ResultBoxTypes.RESULT_BOX?document.getElementById("resultText").innerHTML="":r===ResultBoxTypes.SCORE_BOX?document.getElementById("scoreText").innerHTML="":r===ResultBoxTypes.RESULT_SCORE_PERCENTAGE_BOX&&(document.getElementById("resultText").innerHTML="",document.getElementById("scoreText").innerHTML="",document.getElementById("percentText").innerHTML="")}function getInference(e,t){var n=[];if(e){for(var r=0,o=scoreHistory.length,a=0;o>a;a++){var l=Number(scoreHistory[a].rowIndex),i=getBoxInfo(l.toString()),s=Number(scoreHistory[a].cellIndex),d=Number(i.options[s].value);r+=d}t===ResultBoxTypes.RESULT_SCORE_BOX||t===ResultBoxTypes.RESULT_SCORE_PERCENTAGE_BOX?n.push({inferenceText:analyzeInference(r),scoreSum:r}):t===ResultBoxTypes.RESULT_BOX?n.push({inferenceText:analyzeInference(r),scoreSum:r}):t===ResultBoxTypes.SCORE_BOX&&n.push({scoreSum:r})}return n}function analyzeInference(sum){for(var conclusion="",range=getBoxInfo("999"),resultLength=range.result.length,item=0;resultLength>item;item++)eval(sum+range.result[item].operator+range.result[item].value)&&(conclusion=range.result[item].inference);return conclusion}function saveHistory(){return JSON.stringify(scoreHistory)}function sendHistory(){Android.saveData(JSON.stringify(scoreHistory))}function addFootnoteButton(e){var t=document.createElement("button");return t.setAttribute("class",StyleClass.ABB_BUTTON),t.setAttribute("id","refButton"),t.innerHTML=document.createTextNode(e.buttonText).data,t}function addMoreInfoButton(e){var t=document.createElement("div"),n=document.createElement("button");n.setAttribute("class",StyleClass.MORE_INFO_BUTTON),n.setAttribute("id","moreInfobutton");var r=document.createTextNode(e.moreInfotext);return n.innerHTML=r.nodeValue,t.appendChild(n),t}function addFlipPdfButton(){var e=document.createElement("img");e.setAttribute("src","algo_pdf.png"),e.setAttribute("class",StyleClass.PDF_IMAGE);var t=document.createElement("button");t.setAttribute("id","pdfButton"),t.setAttribute("class",StyleClass.FLIP_PDF_BUTTON);var n=document.createElement("a");return n.setAttribute("href","flipView"),t.appendChild(e),n.appendChild(t),n}function addFooter(){var e=document.getElementsByTagName("body")[0],t=document.createElement("div");t.setAttribute("class",StyleClass.FOOTER),t.setAttribute("id","998");var n=getBoxInfo("998"),r=document.createElement("table");(n.hasPdfButton||n.hasFootnote||n.hasAbbreviation)&&r.appendChild(getFootNoteButtonRow(n)),n.hasFootnote&&r.appendChild(getReferenceTextRow(n)),n.hasAbbreviation&&r.appendChild(getAbbreviationTextRow(n)),n.hasMoreInfoButton&&r.appendChild(getMoreInfoLinkButton(n)),""!==n.resetButtonText.trim()&&r.appendChild(getResetButton(n)),t.appendChild(r),e.appendChild(t),n.extraButtons.length>0&&e.appendChild(addExtraButtons(n))}function getFootNoteButtonRow(e){var t=document.createElement("tr"),n=document.createElement("td");return e.hasPdfButton&&n.appendChild(addFlipPdfButton()),(e.hasFootnote||e.hasAbbreviation)&&n.appendChild(addFootnoteButton(e)),t.appendChild(n),t}function getReferenceTextRow(e){var t=document.createElement("tr"),n=document.createElement("p");n.setAttribute("class",StyleClass.TEXT_LEFT),n.innerHTML=document.createTextNode(e.referenceText).data;var r=document.createElement("div");r.setAttribute("class",StyleClass.REFERENCE_BOX),r.appendChild(n);var o=document.createElement("td");return o.appendChild(r),t.appendChild(o),t}function getAbbreviationTextRow(e){var t=document.createElement("tr"),n=document.createTextNode(e.abbreviationText),r=document.createElement("p");r.setAttribute("class",StyleClass.TEXT_LEFT),r.innerHTML=n.data;var o=document.createElement("div");o.setAttribute("class",StyleClass.REFERENCE_BOX),o.appendChild(r);var a=document.createElement("td");return a.appendChild(o),t.appendChild(a),t}function getMoreInfoLinkButton(e){var t=document.createElement("tr"),n=document.createElement("td");return n.appendChild(addMoreInfoButton(e)),t.appendChild(n),t}function getResetButton(e){var t=document.createElement("tr"),n=document.createElement("td");return n.appendChild(addResetButton(e)),t.appendChild(n),t}function addResetButton(e){var t=document.createElement("div"),n=document.createElement("button");n.setAttribute("class",StyleClass.RESET_BUTTON),n.setAttribute("id","resetButton");var r=document.createTextNode(e.resetButtonText);return n.innerHTML=r.nodeValue,t.appendChild(n),t}function addExtraButtons(e){var t=e.extraButtons,n=document.createElement("div");n.setAttribute("class","extra-buttons-div"),n.setAttribute("id","extraButtons");for(var r=0;r<t.length;r++){var o=document.createElement("table");o.appendChild(getExtraButtonRow(t[r])),n.appendChild(o)}return n}function getExtraButtonRow(e){for(var t=document.createElement("tr"),n=e.buttonRow,r=makeSizer(n.length),o=0;o<n.length;o++){var a=document.createElement("td");a.setAttribute("class","extra-button"),a.style.width=r;var l=document.createElement("button");l.setAttribute("class","mextra-button"),l.setAttribute("id",n[o].buttonId),l.innerHTML=document.createTextNode(n[o].text).data,a.appendChild(l),t.appendChild(a)}return t}function setParameters(e){for(var t=JSON.parse(e),n=Object.keys(t[0]),r=0;r<n.length;r++){var o=n[r],a=scoreHistory[mapping[o]],l=t[0][o];""!==l&&(a.cellIndex=getSelectedCellIndex(o,l),a.status="true")}for(var i=document.getElementById("mainDiv");i.hasChildNodes();)i.removeChild(i.lastChild);var s=document.getElementById("998");"undefined"!=typeof s&&document.getElementsByTagName("body")[0].removeChild(s);var d=document.getElementById("extraButtons");"undefined"!=typeof d&&document.getElementsByTagName("body")[0].removeChild(d),loadDataFile(JSON.stringify(scoreHistory))}function makeSizer(e){return 100/e+"%"}function getColspanFactor(){for(var e=1,t=text.length,n=1;t-3>n;n++)e*=text[n].options.length;return e}var metaInfo,colspanFactor,scoreHistory=[],exception=function(e,t){return{displayMessage:function(){var n=document.createTextNode(e+"<br/>"+t.toString()),r=document.createElement("p");r.setAttribute("class",StyleClass.EXCEPTION_MESSAGE),r.innerHTML=n.data,document.getElementsByTagName("body")[0].appendChild(r)}}};const DecisionButtonStyles={LEFT_BUTTON_STYLE:1,RIGHT_BUTTON_STYLE:2,CENTER_BUTTON_STYLE:3},BoxStructure={BOX_MULTI_LINE_TABULAR:"box-multi-line-tabular",BOX_MULTI_LINE_NON_TABULAR:"box-multi-line-non-tabular",BOX_SINGLE_LINE_TABULAR:"box-single-line-tabular",BOX_SINGLE_LINE_NON_TABULAR:"box-single-line-non-tabular"},ButtonStructure={BUTTON_MULTI_LINE_TABULAR:"button-multi-line-tabular",BUTTON_MULTI_LINE_NON_TABULAR:"button-multi-line-non-tabular",BUTTON_SINGLE_LINE_TABULAR:"button-single-line-tabular",BUTTON_SINGLE_LINE_NON_TABULAR:"button-single-line-non-tabular",BUTTON_SINGLE_LINE_NON_TABULAR_SPANNED:"button-single-line-non-tabular-spanned"},ToolType={RESULT_SCORE:"result-score",NON_RESULT_INFORMATION_SCORE:"non-result-information-score",RESULT_SLIDING_SCORE:"result-sliding-score",RESULT_CATEGORIES_SCORE:"result-categories-score"},ResultBoxTypes={RESULT_BOX:"result-box",SCORE_BOX:"score-box",RESULT_SCORE_BOX:"result-score-box",RESULT_CATEGORIES:"result-categories",NONE:"none",FOOTER:"footer",RESULT_SCORE_PERCENTAGE_BOX:"result-score-percentage-box"},StyleClass={MINFO_TEXT1:"minfo-text1",MINFO_TEXT_BOLD:"minfo-text-bold",ABB_BUTTON:"abb-button",PDF_IMAGE:"pdf-image",REFERENCE_BOX:"reference-box",TEXT_LEFT:"text-left",FOOTER:"footer",FLIP_PDF_BUTTON:"flip-pdf-button",EXCEPTION_MESSAGE:"exception-message",MORE_INFO_BUTTON:"more-info-button",RESET_BUTTON:"reset-button"},Scroll={LENGTH_SHORT:100,LENGTH_LONG:700};